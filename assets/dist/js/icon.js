import{_ as p}from"./addable-box.js";import{e as u}from"./general.js";(function(n){class h{constructor(i){this.$_icon=i,this._onPopupOpen(),this._callAjaxWithSelectedIcon(),this._addSelectedIconOnPreviewArea(),this._removeSelectedIcon(),this._searchIcon()}_onPopupOpen(){const i=this;this.$_icon.off("click",".dht-thickbox").on("click",".dht-thickbox",function(){const e=n(this),t=e.siblings(".dht-modal-icons").find(".dht-icons-type-group");t.children(".dht-search-for-icon").val("");let s=e.siblings(".dht-icon-select-value").val(),r="dashicons",a="";if(s.length>0){const o=JSON.parse(s);r=o["icon-type"],a=o["icon-class"]}t.children(".dht-icons-type").val(r),i._getIconsViaAjax(r,t,a)})}_callAjaxWithSelectedIcon(){const i=this;n(document).off("change",".dht-icons-preview-group .dht-icons-type").on("change",".dht-icons-preview-group .dht-icons-type",function(){const e=n(this),t=e.val();t.length!==0&&(e.parent(".dht-icons-type-group").siblings(".dht-icons-preview").empty(),i._getIconsViaAjax(t,e.parent(".dht-icons-type-group"),""))})}_addSelectedIconOnPreviewArea(){const i=this;n(document).off("click","#TB_window .dht-icons-preview i").on("click","#TB_window .dht-icons-preview i",function(){const e=n(this),t=e.attr("class"),s=e.attr("data-code"),r=e.parents(".dht-icons-preview-group").children(".dht-icons-type-group").children(".dht-icons-type"),a=e.parents(".dht-icons-preview-group").attr("data-popup-id"),o=n("#"+a);o.siblings(".dht-icon-select-preview").children("i").removeAttr("class").addClass(t).parent().addClass("dht-icon-select-preview-show"),o.siblings(".dht-icon-select-value").val(JSON.stringify({"icon-type":r.val(),"icon-class":t,"icon-code":s})),o.siblings(".dht-btn-remove").addClass("dht-btn-show"),n("#TB_closeWindowButton").trigger("click"),i._liveEditing(o.parents(".dht-field-wrapper-icons"),t).then(()=>{}).catch(c=>{console.error(c)})})}_removeSelectedIcon(){const i=this;this.$_icon.off("click",".dht-btn-remove").on("click",".dht-btn-remove",function(){const e=n(this);return e.siblings(".dht-icon-select-preview").children("i").removeAttr("class").parent().removeClass("dht-icon-select-preview-show"),e.siblings(".dht-icon-select-value").val(""),e.removeClass("dht-btn-show"),i._liveEditing(e.parents(".dht-field-wrapper-icons"),"").then(()=>{}).catch(t=>{console.error(t)}),!1})}_searchIcon(){n(document).off("keyup",".dht-icons-preview-group .dht-search-for-icon").on("keyup",".dht-icons-preview-group .dht-search-for-icon",function(){const i=n(this),e=i.parents(".dht-icons-preview-group"),t=i.val().toLowerCase();e.children(".dht-icons-preview").children("i").each(function(){const s=n(this);s.attr("class").toLowerCase().indexOf(t)===-1?s.hide():s.show()})})}_getIconsViaAjax(i,e,t){e.children(".dht-icons-type").prop("disabled",!0),n.ajax({url:dht_framework_info.ajax_url,type:"POST",dataType:"json",data:{action:"getOptionIcons",post_id:n('#post_ID[name="post_ID"]').val(),data:{icon_type:i,icon:t}},beforeSend:function(){e.siblings(".spinner").css("visibility","visible"),e.siblings(".dht-icons-preview").empty()},success:function(s){s.success?e.siblings(".dht-icons-preview").append(s.data):console.error("Ajax Response",s)},error:function(s){console.error("AJAX error:",s)},complete:function(){e.siblings(".spinner").css("visibility","hidden"),e.children(".dht-icons-type").prop("disabled",!1)}})}async _liveEditing(i,e){if((i.attr("data-live-selectors")??"").length)try{let t=function(o,c,l){o==="class"&&n(c).attr("class",l)};const{dhtApplyChangesForNotKeyedSelectors:s,dhtRestoreElementDefaultValues:r,dhtGetDefaultValue:a}=await p(async()=>{const{dhtApplyChangesForNotKeyedSelectors:o,dhtRestoreElementDefaultValues:c,dhtGetDefaultValue:l}=await import("./live-editing.js");return{dhtApplyChangesForNotKeyedSelectors:o,dhtRestoreElementDefaultValues:c,dhtGetDefaultValue:l}},[]);s(i,(o,c)=>{t(o,c,e)},(o,c)=>{r(i,()=>{t(o,c,a(i))})})}catch(t){u(t)}}}function d(){n(".dht-field-wrapper-icons").each(function(){new h(n(this))})}n(function(){d()}),n(document).on("dht_iconAjaxComplete",function(){d()})})(jQuery);
