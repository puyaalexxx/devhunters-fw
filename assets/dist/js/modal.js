import{_ as it}from"./addable-box.js";import{e as dt}from"./general.js";function q(e){let d=q.name,r=0;const t=(0,window.jQuery)(this),c=400,u=500;let l=function(o){let i="rest",m=0,w=0,s=0,g=0,n=0,x=0,Q=0,D=0,F=0,B=0,X=0,P=0,G=(0,window.jQuery)(this).attr("data-dialogResizable"),K=(0,window.jQuery)(this).attr("data-dialogMovable"),U=(0,window.jQuery)(this).attr("data-dialogTouchOutsideForClose"),Z=4*2,R=((0,window.jQuery)(this).find(".dht-vb-modal-header").outerHeight()||0)+Z,j=0,T=0,Y=142,v=0,I=0,tt=(0,window.jQuery)(this).children(".dht-vb-modal-header"),E=(0,window.jQuery)(this).children(".dht-vb-modal-content"),L=E.children(".dht-vb-modal-content-options"),et=(0,window.jQuery)(this).children(".dht-vb-modal-footer");function A(){typeof o.beforeCloseCallback=="function"?o.beforeCloseCallback&&(o.beforeCloseCallback(),t.fadeOut("400",function(){typeof o.afterClosedCallback=="function"&&o.afterClosedCallback&&o.afterClosedCallback()})):t.fadeOut()}function ot(){const a=(0,window.jQuery)(window).width()||0,f=(0,window.jQuery)(window).height()||0,C=(0,window.jQuery)("#wpadminbar").outerHeight()||0,b=t.outerWidth()||0,p=t.outerHeight()||0;let h=b,_=p;b>a&&(h=c),p>f&&(_=u),(h!==b||_!==p)&&(t.css("width",h+"px"),t.css("height",_+"px"));const M=t.outerWidth()||0,W=t.outerHeight()||0,$=parseFloat(t.css("left"))||0,H=parseFloat(t.css("top"))||0;let V=Math.min(Math.max($,0),a-M),J=Math.min(Math.max(H,C),f-W);(V!==$||J!==H)&&t.css({left:V+"px",top:J+"px"})}(0,window.jQuery)(window).on("resize",function(){ot()});let S=!1;(0,window.jQuery)(window).on("scroll",function(){S=!0});let N;(0,window.jQuery)(window).on("scroll",function(){clearTimeout(N),N=setTimeout(function(){S=!1},50)}),U==="true"&&(0,window.jQuery)(document).on("mouseup",function(a){const f=a.target;i==="rest"&&!t.is(f)&&t.has(f).length===0&&A()}),K==="true"&&(0,window.jQuery)(this).find(".dht-vb-modal-header").on("mousedown",function(a){i==="rest"&&(m=a.pageX,w=a.pageY,s=t.position().left,g=t.position().top,n=t.width()||0,x=t.height()||0,Q=a.pageX-s,D=a.pageY-g),i="move"}),G==="true"&&(0,window.jQuery)(this).find(".dht-vb-modal-resize").on("mousedown",function(a){i==="rest"&&(m=a.pageX,w=a.pageY,s=t.position().left,g=t.position().top,n=t.width()||0,x=t.height()||0,Q=a.pageX-s,D=a.pageY-g,F=g+x,B=F-w,X=s+n,P=X-m),i="bottom_right_resize"}),(0,window.jQuery)(this).on("mouseup",function(){i="rest",(0,window.jQuery)(document).css({cursor:"default"})}),(0,window.jQuery)(document).on("mouseup",function(){i="rest",(0,window.jQuery)(document).css({cursor:"default"})}),(0,window.jQuery)(document).on("mousemove",function(a){if(!S){if(i==="move"){const f=(0,window.jQuery)(window).width()||0,C=(0,window.jQuery)(window).height()||0,b=(0,window.jQuery)("#wpadminbar").outerHeight()||0;let p=a.pageX-Q,h=a.pageY-D;const _=t.outerWidth()||0,M=t.outerHeight()||0;p=Math.min(Math.max(p,0),f-_),h<b?h=b:h=Math.min(Math.max(h,0),C-M),t.css({left:p+"px",top:h+"px"})}else if(i==="bottom_right_resize"){T=a.pageY-g+B,j=T>R?T:R,I=a.pageX-s+P,v=I>Y?I:Y;const f=(0,window.jQuery)(window).width()||0,C=(0,window.jQuery)(window).height()||0;(0,window.jQuery)("#wpadminbar").outerHeight();const b=f-s,p=C-g,h=400,_=400;v=Math.min(Math.max(v,h),b),j=Math.min(Math.max(j,_),p);let M=parseInt(L.css("padding-top"))||0,W=parseInt(L.css("padding-bottom"))||0,$=tt.outerHeight()||0,H=et.outerHeight()||0;v<=768?t.addClass("dht-modal-small").removeClass("dht-modal-medium dht-modal-large"):v>=769&&v<=1366?t.addClass("dht-modal-medium").removeClass("dht-modal-small dht-modal-large"):t.addClass("dht-modal-large").removeClass("dht-modal-small dht-modal-medium"),t.css({width:v+"px",height:j+"px"}),E.css({height:j-$-H+"px"}),L.css({height:j-$-H-M-W+"px"}),(0,window.jQuery)(document).css({cursor:"se-resize"})}}}),t.find(".dht-vb-modal-close, .dht-vb-modal-save").on("click",function(){(0,window.jQuery)(".dht-vb-enabled .dht-vb-module").removeClass("dht-vb-disabled")}),(0,window.jQuery)(this).find(".dht-vb-modal-close").on("click",function(){lt(t),A(),t.remove()}),t.find(".dht-vb-modal-save").on("click",function(){nt(t,A)})},y=function(o){(0,window.jQuery)(this).attr("data-dialogId");let i=(0,window.jQuery)(this),m=(0,window.jQuery)(this).attr("data-dialogAutoClose"),w=m?parseInt(m,10):void 0;(0,window.jQuery)(this).fadeIn(400,function(){typeof o.afterOpenedCallback=="function"&&o.afterOpenedCallback&&o.afterOpenedCallback()}),m!=="false"&&setTimeout(function(){k.call(i,o)},w)},k=function(o){(0,window.jQuery)(this).attr("data-dialogId")},z={init:function(o){return this.each(function(){r+=1;let i=(0,window.jQuery)(window).width()||0,m=(0,window.jQuery)(window).height()||0,w=(0,window.jQuery)(this),s=(0,window.jQuery)(this);if(!w.data(d)){let n={autoClose:!1,pos_x:0,pos_y:0,movable:!0,resizable:!0,touchOutsideForClose:!1,beforeOpenCallback:!1,afterOpenedCallback:!1,beforeCloseCallback:!1,afterClosedCallback:!1,width:c,height:u};o&&window.jQuery.extend(!0,n,o),n.pos_x===0&&(n.pos_x=(i-n.width)/2),n.pos_y===0&&(n.pos_y=(m-n.height)/2),s.html(),s.attr("data-dialogId",r),s.attr("data-dialogResizable",String(n.resizable)),s.attr("data-dialogMovable",String(n.movable)),s.attr("data-dialogAutoClose",String(n.autoClose)),s.attr("data-dialogTouchOutsideForClose",String(n.touchOutsideForClose)),(0,window.jQuery)(this).css({position:"fixed","z-index":"999",display:"none",left:n.pos_x+"px",top:n.pos_y+"px"}),w.data(d,{target:w,settings:n});let x=(0,window.jQuery)(this),Q=w.data(d);l.call(x,Q)}})},open:function(){return this.each(function(){let o=(0,window.jQuery)(this),i=o.data(d);typeof i.settings.beforeOpenCallback=="function"?i.settings.beforeOpenCallback&&(i.settings.beforeOpenCallback(),y.call(o,i)):y.call(o,i),at(o)})},close:function(){return this.each(function(){let o=(0,window.jQuery)(this),i=o.data(d);k.call(o,i)})},destroy:function(){return this.each(function(){let o=(0,window.jQuery)(this);o.data(d),o.removeData()})}};return typeof e=="string"&&z[e]?z[e].apply(this):typeof e=="object"||!e?z.init.apply(this,[e]):(window.jQuery.error("Method "+e+" does not exist in jQuery."+d),this)}window.jQuery.fn.dhtVBModal=function(e){return q.call(this,e)};function ht(e){const{$vbModule:d,modalID:r,moduleName:t,modalTitle:c,hiddenInputClass:u}=e,l=`
        <div id="dht-modal-${r}" class="dht-vb-modal dht-modal-small" data-module-id="${r}" data-module-name="${t}" data-module-input="${u}">
        
            <div class="dht-vb-modal-header"><span class="dht-vb-modal-title">${c}</span></div>
            
            <div class="dht-vb-modal-content">
                <div class="dht-preloader dht-hidden" data-delay="500"><div class="dht-spinner-loader"></div></div>
                <div class="dht-vb-modal-content-options"></div>
            </div>
            
            <div class="dht-vb-modal-footer">
               <div class="dht-vb-modal-close">
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                       <path
                           d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z" />
                   </svg>
               </div>
               <div class="dht-vb-modal-save">
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                       <path
                           d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z" />
                   </svg>
               </div>
               <div class="dht-vb-modal-resize">
                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                       <path
                           d="M200 32L56 32C42.7 32 32 42.7 32 56l0 144c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l40-40 79 79-79 79L73 295c-6.9-6.9-17.2-8.9-26.2-5.2S32 302.3 32 312l0 144c0 13.3 10.7 24 24 24l144 0c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-40-40 79-79 79 79-40 40c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l144 0c13.3 0 24-10.7 24-24l0-144c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2l-40 40-79-79 79-79 40 40c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2l0-144c0-13.3-10.7-24-24-24L312 32c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l40 40-79 79-79-79 40-40c6.9-6.9 8.9-17.2 5.2-26.2S209.7 32 200 32z" />
                   </svg>
               </div>
            </div>
            
        </div>
   `;(0,window.jQuery)("#dht-modal-"+r).length===0&&d.append(l)}function at(e){const d=e.children(".dht-vb-modal-content"),r=d.children(".dht-vb-modal-content-options"),t=e.attr("data-module-input"),c=d.children(".dht-preloader"),u=e.children(".dht-vb-modal-footer");window.jQuery.ajax({url:dht_framework_info.ajax_url,type:"POST",dataType:"json",data:{action:"getModalOptions",post_id:(0,window.jQuery)('#post_ID[name="post_ID"]').val(),data:{moduleName:e.attr("data-module-name"),moduleID:e.attr("data-module-id"),formSavedData:e.siblings("."+t).val()}},beforeSend:function(){r.empty(),O(c,u)},success:function(l){l.success?(r.empty(),r.append(l.data),O(c,u),setTimeout(function(){it(()=>import("./ajax-options-reload.js"),[]).then(y=>{const{dhtReinitializeOptions:k}=y;k(r)}).catch(y=>{dt(y)})},200)):console.error("Ajax Response: ",l)},error:function(l){console.error("AJAX error: ",l)},complete:function(){}})}function nt(e,d){const r=e.find("form"),t=e.attr("data-module-input"),c=e.children(".dht-vb-modal-footer"),u=e.find(".dht-preloader");window.jQuery.ajax({url:dht_framework_info.ajax_url,type:"POST",dataType:"json",data:{action:"saveModalOptions",post_id:(0,window.jQuery)('#post_ID[name="post_ID"]').val(),data:{moduleName:e.attr("data-module-name"),moduleID:e.attr("data-module-id"),formData:r.serialize()}},beforeSend:function(){O(u,c)},success:function(l){l.success?(e.siblings("."+t).val(l.data),O(u,c),d(),e.remove()):console.error("Ajax Response: ",l)},error:function(l){console.error("AJAX error: ",l)},complete:function(){}})}function O(e,d){e.toggleClass("dht-hidden"),d.toggleClass("dht-vb-modal-footer-disabled")}function lt(e){const d=e.find(".dht-colorpicker");d.length>0&&d.wpColorPicker("close")}export{ht as dhtCreateVBModal};
