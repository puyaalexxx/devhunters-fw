import{_ as s}from"./addable-box.js";import{e as d}from"./general.js";(function(i){class l{constructor(n){this.$_typography=n;const t=this;this.$_preview_area=this.$_typography.children(".dht-field-child-typography-preview"),this.$_fonts_dropdown=this.$_typography.find(".dht-typography"),this.$_font_weight_dropdown=this.$_typography.find(".dht-typography-weight"),this.$_font_style_dropdown=this.$_typography.find(".dht-typography-style"),this.$_font_subsets_dropdown=this.$_typography.find(".dht-typography-subsets"),this.$_text_transform_dropdown=this.$_typography.find(".dht-typography-transform"),this.$_text_decoration_dropdown=this.$_typography.find(".dht-typography-decoration"),this.$_text_align_dropdown=this.$_typography.find(".dht-typography-align"),this.$_text_font_size=this.$_typography.find(".dht-typography-font-size"),this.$_text_line_height=this.$_typography.find(".dht-typography-line-height"),this.$_text_letter_spacing=this.$_typography.find(".dht-typography-letter-spacing"),this.$_colorpicker=this.$_typography.find(".dht-colorpicker"),this._font_prefix=this.$_fonts_dropdown.attr("data-font-prefix"),this.$_font_type_hidden_input=this.$_fonts_dropdown.siblings(".dht-typography-font-type-hidden"),this.$_font_path_hidden_input=this.$_fonts_dropdown.siblings(".dht-typography-path-hidden"),this._setHeaderFontFromSavedValues(t),this._fontDropdown(t),this._fontWeightsDropdown(t),this._fontStylesDropdown(t),this._fontSubsetsDropdown(t),this._textTransformDropdown(t),this._textDecorationDropdown(t),this._textAlignDropdown(t),this._fontSize(t),this._lineHeight(t),this._letterSpacing(t),this._initColorpicker(t).then(()=>{}).catch(e=>{console.error(e)})}_fontDropdown(n){this.$_fonts_dropdown.select2({}),this.$_fonts_dropdown.off("change.mychange").on("change.mychange",function(){const t=i(this),e=String(t.find("option:selected").attr("data-font-type")),o=n._getSelectedFontFamily(n,t);n._applyStyles("font-family",o.length?o:""),o.length?e==="google"?n._googleFontsManipulations(n,t,o):e==="standard"?n._standardFontsManipulations(n):n._customFontsManipulations(n,t,o):n._setFontFamilyHiddenInputs(n,"","")})}_googleFontsManipulations(n,t,e){n._setFontFamilyHiddenInputs(n,"google","");const o=String(t.find("option:selected").attr("data-font-subsets"));n._buildFontLink(e);const a=t.find("option:selected").attr("data-font-weights");n._populateFontWeightDropdown(n,a),n._populateFontSubsetsDropdown(n,o),n.$_font_weight_dropdown.trigger("change.mychange")}_customFontsManipulations(n,t,e){const o=n._getCustomFontPath(t);n._setFontFamilyHiddenInputs(n,"divi",o),n._addHeaderFontFaceStyle(n,e,o),n.$_font_subsets_dropdown.empty().trigger("change.mychange");const a=t.find("option:selected").attr("data-font-weights");n._populateFontWeightDropdown(n,a)}_standardFontsManipulations(n){n._setFontFamilyHiddenInputs(n,"standard",""),n.$_font_subsets_dropdown.empty().trigger("change.mychange");const t=n.$_font_weight_dropdown.attr("data-standard-font-weights");n._populateFontWeightDropdown(n,t)}_fontWeightsDropdown(n){this.$_font_weight_dropdown.select2({}),this.$_font_weight_dropdown.off("change.mychange").on("change.mychange",function(){const t=String(i(this).val()),e=n._getSelectedFontFamily(n);t.length!==0&&n._buildFontLink(e,t),n._applyStyles("font-weight",t.length?t:"")})}_fontSubsetsDropdown(n){this.$_font_subsets_dropdown.select2({})}_fontStylesDropdown(n){this.$_font_style_dropdown.select2({}),this.$_font_style_dropdown.off("change.mychange").on("change.mychange",function(){const t=String(i(this).val());n._applyStyles("font-style",t.length?t:"")})}_textTransformDropdown(n){this.$_text_transform_dropdown.select2({}),this.$_text_transform_dropdown.off("change.mychange").on("change.mychange",function(){const t=String(i(this).val());t==="small-caps"?(n._applyStyles("font-variant",t.length?t:""),n._applyStyles("text-transform","")):(n._applyStyles("text-transform",t.length?t:""),n._applyStyles("font-variant",""))})}_textDecorationDropdown(n){this.$_text_decoration_dropdown.select2({}),this.$_text_decoration_dropdown.off("change.mychange").on("change.mychange",function(){const t=String(i(this).val());n._applyStyles("text-decoration",t.length?t:"")})}_textAlignDropdown(n){this.$_text_align_dropdown.select2({}),this.$_text_align_dropdown.off("change.mychange").on("change.mychange",function(){const t=String(i(this).val());n._applyStyles("text-align",t.length?t:"")})}_fontSize(n){this.$_text_font_size.children("select").off("change").on("change",function(){const t=String(i(this).val()),e=String(i(this).siblings(".dht-input").val());n._applyStyles("font-size",e+t)}),this.$_text_font_size.children(".dht-input").off("input change").on("input change",function(){const t=String(i(this).val()),e=String(i(this).siblings("select").val()),o=t.length===0?0+e:t+e;n._applyStyles("font-size",o)})}_lineHeight(n){this.$_text_line_height.children("select").off("change").on("change",function(){const t=String(i(this).val()),e=String(i(this).siblings(".dht-input").val());n._applyStyles("line-height",e+t)}),this.$_text_line_height.children(".dht-input").off("input change").on("input change",function(){const t=String(i(this).val()),e=String(i(this).siblings("select").val()),o=t.length===0?0+e:t+e;n._applyStyles("line-height",o)})}_letterSpacing(n){this.$_text_letter_spacing.children("select").off("change").on("change",function(){const t=String(i(this).val()),e=String(i(this).siblings(".dht-input").val());n._applyStyles("letter-spacing",e+t)}),this.$_text_letter_spacing.children(".dht-input").off("input change").on("input change",function(){const t=String(i(this).val()),e=String(i(this).siblings("select").val()),o=t.length===0?0+e:t+e;n._applyStyles("letter-spacing",o)})}async _initColorpicker(n){try{const{dhtInitColorpicker:t,dhtOnChangeColorpicker:e}=await s(async()=>{const{dhtInitColorpicker:o,dhtOnChangeColorpicker:a}=await import("./colorpicker-utilities.js");return{dhtInitColorpicker:o,dhtOnChangeColorpicker:a}},[]);this.$_colorpicker.each(function(){const o=i(this);t(o),e(o,a=>{n._applyStyles("color",a)})})}catch(t){d(t)}}_populateFontWeightDropdown(n,t){n.$_font_weight_dropdown.empty(),t&&t.length>0&&(n.$_font_weight_dropdown.append("<option></option>"),i.each(JSON.parse(t),function(e,o){n.$_font_weight_dropdown.append('<option value="'+e+'">'+o+"</option>")}))}_populateFontSubsetsDropdown(n,t){n.$_font_subsets_dropdown.empty(),t.length>0&&(n.$_font_subsets_dropdown.append("<option></option>"),i.each(JSON.parse(t),function(e,o){n.$_font_subsets_dropdown.append('<option value="'+o+'">'+o+"</option>")}))}_setHeaderFontFromSavedValues(n){let t=this.$_fonts_dropdown.attr("data-saved-values");if(t.length>0){const e=JSON.parse(t);e.font_type==="google"&&n._buildFontLink(e.font,e.weight)}}_addHeaderFontFaceStyle(n,t,e){if(e.length>0){const o=n._getFontFormatFromPath(e);i(`<style class='dht-custom-font-face-style'>@font-face{font-family:${t};src:url(${encodeURI(e)}) format('${o}');font-display: swap;}</style>`).appendTo("head")}}_getCustomFontPath(n){return String(n.find("option:selected").attr("data-font-path"))}_getFontFormatFromPath(n){var o;const t=(o=n.split(".").pop())==null?void 0:o.toLowerCase();let e;switch(t){case"otf":e="opentype";break;case"ttf":e="truetype";break;case"woff":e="woff";break;case"woff2":e="woff2";break;default:e="truetype";break}return e}_buildFontLink(n,t=""){let e="https://fonts.googleapis.com/css2?family="+n;t.length>0&&(e="https://fonts.googleapis.com/css2?family="+n+":wght@"+t),i('<link href="'+e+'" rel="stylesheet">').appendTo("head")}_getSelectedFontFamily(n,t=i()){return t=t.length>0?t:n.$_fonts_dropdown,(t.val()?String(t.val()):"").replace(new RegExp(`^${n._font_prefix}-`),"")}_setFontFamilyHiddenInputs(n,t,e){n.$_font_type_hidden_input.attr("value",t),n.$_font_path_hidden_input.attr("value",e)}_applyStyles(n,t){this.$_preview_area.css(n,t),this._liveEditing({[n]:t}).then(()=>{}).catch(e=>{console.error(e)})}async _liveEditing(n){if((this.$_typography.attr("data-live-selectors")??"").length)try{let t=function(p,r){i(p).css(r)};const{dhtApplyChangesForNotKeyedSelectors:e,dhtRestoreElementDefaultValues:o,dhtGetDefaultValue:a}=await s(async()=>{const{dhtApplyChangesForNotKeyedSelectors:p,dhtRestoreElementDefaultValues:r,dhtGetDefaultValue:h}=await import("./live-editing.js");return{dhtApplyChangesForNotKeyedSelectors:p,dhtRestoreElementDefaultValues:r,dhtGetDefaultValue:h}},[]);e(this.$_typography,(p,r)=>{p==="style"&&t(r,n)},(p,r)=>{p==="style"&&o(this.$_typography,()=>{const h=a(this.$_typography);h.length&&t(r,JSON.parse(h))})})}catch(t){d(t)}}}function _(){i(".dht-field-wrapper-typography .dht-field-child-typography").each(function(){new l(i(this))})}i(function(){_()}),i(document).on("dht_typographyAjaxComplete",function(){_()})})(jQuery);
