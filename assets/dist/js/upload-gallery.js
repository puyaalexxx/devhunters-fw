(function(n){class c{constructor(t){this.$_gallery=t,this._uploadGallery(),this._removeGalleryImage(),this._onSortImages()}_uploadGallery(){const t=this;this.$_gallery.off("click",".dht-upload-gallery-button").on("click",".dht-upload-gallery-button",function(){const i=jQuery(this),e=i.siblings(".dht-upload-gallery-hidden"),l=i.attr("data-media-text"),a=wp.media({title:l,button:{text:l},library:{type:"image"},multiple:!0});t._onSelectImages(i,e,a),a.open(),t._preSelectImages(e,a)})}_removeGalleryImage(){const t=this;this.$_gallery.off("click",".dht-gallery-group .dht-img-remove-icon").on("click",".dht-gallery-group .dht-img-remove-icon",function(){const i=n(this).parents(".dht-gallery-group").siblings(".dht-upload-gallery-hidden"),e=n(this).siblings("img").attr("data-id");let l=t._getHiddenInputValues(i);l.length>0&&l.indexOf(e)>-1&&(l.splice(l.indexOf(e),1),i.val(l.join(","))),n(this).parent(".dht-img-remove").remove()})}_onSelectImages(t,i,e){e.off("select").on("select",function(){let l=t.siblings(".dht-gallery-group");l.empty();const a=e.state().get("selection").toJSON(),o=[];let r=[];for(let s=0;s<a.length;s++)o.push(a[s].id),r.push({id:a[s].id,url:a[s].url});i.val(o.join(",")),r.forEach(function(s){l.append('<span class="dht-img-remove"><span class="dht-img-remove-icon"></span><img data-id="'+s.id+'" src="'+s.url+'" alt="" width="100" height="100" /></span>')})})}_preSelectImages(t,i){let e=this._getHiddenInputValues(t);if(e.length>0){const l=i.state().get("selection");e.forEach(function(a){let o=wp.media.attachment(a);o.fetch(),l.add(o?[o]:[])})}}_onSortImages(){this.$_gallery.find(".dht-gallery-group").sortable({containment:"parent",update:function(){let t=n(this).children(".dht-img-remove").map(function(){return n(this).find("img").attr("data-id")}).get();n(this).siblings(".dht-upload-gallery-hidden").val(t.join(","))}}).disableSelection()}_getHiddenInputValues(t){let i=String(t.val()),e=[];return i.length>0&&(e=i.split(",")),e}}function d(){n(".dht-field-wrapper-upload-gallery").each(function(){new c(n(this))})}n(function(){d()}),n(document).on("dht_uploadGalleryAjaxComplete",function(){d()})})(jQuery);
