import{_ as c}from"./addable-box.js";import{e as p}from"./general.js";(function(o){class h{constructor(i){this.$_uploadImage=i,this._uploadImage(),this._removeImageOnInput()}_uploadImage(){const i=this;this.$_uploadImage.off("click",".dht-upload-image-button").on("click",".dht-upload-image-button",function(){const t=o(this),n=t.siblings(".dht-upload-hidden"),d=t.attr("data-media-text"),s=wp.media({title:d,button:{text:d},library:{type:"image"},multiple:!1});s.off("select").on("select",function(){const a=t.siblings(".dht-upload");a.siblings("img").remove();const e=s.state().get("selection").first().toJSON();a.val(e.url),a.attr("value",e.url),i._liveEditing(e.url).then(()=>{}).catch(l=>{console.error(l)}),n.val(e.id),a.before('<img src="'+e.url+'" width="100" height="100"  alt=""/>')}),s.open(),i._preSelectImages(n,s)})}_removeImageOnInput(){const i=this;this.$_uploadImage.off("input",".dht-upload").on("input",".dht-upload",function(){const t=o(this);t.val()===""&&(t.siblings("img").remove(),t.siblings(".dht-upload-hidden").val(""),t.attr("value","")),t.val().length>0&&(t.siblings("img").remove(),t.before(`<img src="${t.val()}" width="100" height="100"  alt=""/>`),t.attr("value",t.val())),i._liveEditing(t.val()).then(()=>{}).catch(n=>{console.error(n)})})}_preSelectImages(i,t){+i.val()>0&&t.state().get("selection").add(wp.media.attachment(i.val()))}async _liveEditing(i){if((this.$_uploadImage.attr("data-live-selectors")??"").length)try{let t=function(a,e,l,r){a==="attr"?o(e).attr(l,r):a==="style"&&o(e).css({[l]:`url(${r})`})};const{dhtApplyChangesForKeyedSelectors:n,dhtRestoreElementDefaultValues:d,dhtGetDefaultValue:s}=await c(async()=>{const{dhtApplyChangesForKeyedSelectors:a,dhtRestoreElementDefaultValues:e,dhtGetDefaultValue:l}=await import("./live-editing.js");return{dhtApplyChangesForKeyedSelectors:a,dhtRestoreElementDefaultValues:e,dhtGetDefaultValue:l}},[]);n(this.$_uploadImage,(a,e,l)=>{t(e,l,a,i)},(a,e,l)=>{d(this.$_uploadImage,()=>{t(e,l,a,s(this.$_uploadImage))})})}catch(t){p(t)}}}function u(){o(".dht-field-wrapper-upload-image").each(function(){new h(o(this))})}o(function(){u()}),o(document).on("dht_uploadImageAjaxComplete",function(){u()})})(jQuery);
