import{_}from"./addable-box.js";import{e as f}from"./general.js";(function(i){class d{constructor(t){this.$_wpeditor=t,this._initWPEditor()}_initWPEditor(){const t=this,r=this.$_wpeditor.find("textarea.wp-editor-area").attr("id")??"";r.length!==0&&setTimeout(function(){const e=tinymce.get(r);e&&(t._updateTextTabValueOnChange(r,e),t._liveEditing(r,e).then(()=>{}).catch(n=>{console.error(n)}))},500)}_updateTextTabValueOnChange(t,r){const e=this,n=i("#"+t);n&&r.on("input change",function(){n.val(e._getVisualTabValue(t))})}_getVisualTabValue(t){return tinymce.get(t).getContent()}_getTextTabValue(t){return String(i("#"+t).val())}async _liveEditing(t,r){if(!(this.$_wpeditor.attr("data-live-selectors")??"").length)return;const e=this;try{let n=function(o,a){i(o).html(a)},c=function(o,a,u){if(o==="content"){r.on("input change",function(){a()});const s=i("#"+t);s&&i(s).on("input change",function(){u()})}};const{dhtApplyChangesForNotKeyedSelectors:p,dhtRestoreElementDefaultValues:h}=await _(async()=>{const{dhtApplyChangesForNotKeyedSelectors:o,dhtRestoreElementDefaultValues:a}=await import("./live-editing.js");return{dhtApplyChangesForNotKeyedSelectors:o,dhtRestoreElementDefaultValues:a}},[]);p(this.$_wpeditor,(o,a)=>{c(o,()=>{n(a,e._getVisualTabValue(t))},()=>{n(a,e._getTextTabValue(t))})},(o,a)=>{const u=e._getVisualTabValue(t),s=e._getTextTabValue(t);c(o,()=>{h(e.$_wpeditor,()=>{n(a,u)})},()=>{h(e.$_wpeditor,()=>{n(a,s)})})})}catch(n){f(n)}}}function l(){i(".dht-field-wrapper-editor").each(function(){new d(i(this))})}i(function(){l()}),i(document).on("dht_wpEditorAjaxComplete",function(){l()})})(jQuery);
